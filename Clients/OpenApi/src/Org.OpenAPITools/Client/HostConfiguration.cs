/*
 * Open WebUI
 *
 * No description provided (generated by Openapi Generator https://github.com/openapitools/openapi-generator)
 *
 * The version of the OpenAPI document: 0.1.0
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

#nullable enable

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.Json;
using System.Text.Json.Serialization;
using System.Net.Http;
using Microsoft.Extensions.DependencyInjection;
using Org.OpenAPITools.Api;
using Org.OpenAPITools.Model;

namespace Org.OpenAPITools.Client
{
    /// <summary>
    /// Provides hosting configuration for Org.OpenAPITools
    /// </summary>
    public class HostConfiguration
    {
        private readonly IServiceCollection _services;
        private readonly JsonSerializerOptions _jsonOptions = new JsonSerializerOptions();

        internal bool HttpClientsAdded { get; private set; }

        /// <summary>
        /// Instantiates the class 
        /// </summary>
        /// <param name="services"></param>
        public HostConfiguration(IServiceCollection services)
        {
            _services = services;
            _jsonOptions.Converters.Add(new JsonStringEnumConverter());
            _jsonOptions.Converters.Add(new DateTimeJsonConverter());
            _jsonOptions.Converters.Add(new DateTimeNullableJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyNullableJsonConverter());
            _jsonOptions.Converters.Add(new AddMemoryFormJsonConverter());
            _jsonOptions.Converters.Add(new AddPipelineFormJsonConverter());
            _jsonOptions.Converters.Add(new AddUserFormJsonConverter());
            _jsonOptions.Converters.Add(new AdminConfigJsonConverter());
            _jsonOptions.Converters.Add(new ApiKeyJsonConverter());
            _jsonOptions.Converters.Add(new AudioConfigUpdateFormJsonConverter());
            _jsonOptions.Converters.Add(new AuthTypeJsonConverter());
            _jsonOptions.Converters.Add(new Automatic1111CfgScaleJsonConverter());
            _jsonOptions.Converters.Add(new Automatic1111ConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new AzureOpenAIConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new BannerModelJsonConverter());
            _jsonOptions.Converters.Add(new BatchProcessFilesFormJsonConverter());
            _jsonOptions.Converters.Add(new BatchProcessFilesResponseJsonConverter());
            _jsonOptions.Converters.Add(new BatchProcessFilesResultJsonConverter());
            _jsonOptions.Converters.Add(new CapabilitiesJsonConverter());
            _jsonOptions.Converters.Add(new ChannelFormJsonConverter());
            _jsonOptions.Converters.Add(new ChannelModelJsonConverter());
            _jsonOptions.Converters.Add(new ChatJsonConverter());
            _jsonOptions.Converters.Add(new ChatFolderIdFormJsonConverter());
            _jsonOptions.Converters.Add(new ChatFormJsonConverter());
            _jsonOptions.Converters.Add(new ChatImportFormJsonConverter());
            _jsonOptions.Converters.Add(new ChatPermissionsJsonConverter());
            _jsonOptions.Converters.Add(new ChatResponseJsonConverter());
            _jsonOptions.Converters.Add(new ChatTitleIdResponseJsonConverter());
            _jsonOptions.Converters.Add(new ChatTitleMessagesFormJsonConverter());
            _jsonOptions.Converters.Add(new CloneFormJsonConverter());
            _jsonOptions.Converters.Add(new CodeFormJsonConverter());
            _jsonOptions.Converters.Add(new CodeInterpreterConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new ComfyUIConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new CommentJsonConverter());
            _jsonOptions.Converters.Add(new ConfigJsonConverter());
            _jsonOptions.Converters.Add(new ContentFormJsonConverter());
            _jsonOptions.Converters.Add(new ContentTypeJsonConverter());
            _jsonOptions.Converters.Add(new CopyModelFormJsonConverter());
            _jsonOptions.Converters.Add(new CreateModelFormJsonConverter());
            _jsonOptions.Converters.Add(new DataJsonConverter());
            _jsonOptions.Converters.Add(new DeleteFormJsonConverter());
            _jsonOptions.Converters.Add(new DeletePipelineFormJsonConverter());
            _jsonOptions.Converters.Add(new DescriptionJsonConverter());
            _jsonOptions.Converters.Add(new DirectConnectionsConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new EmbeddingModelUpdateFormJsonConverter());
            _jsonOptions.Converters.Add(new EventFormJsonConverter());
            _jsonOptions.Converters.Add(new FeaturesPermissionsJsonConverter());
            _jsonOptions.Converters.Add(new FeedbackFormJsonConverter());
            _jsonOptions.Converters.Add(new FeedbackFormDataJsonConverter());
            _jsonOptions.Converters.Add(new FeedbackFormSnapshotJsonConverter());
            _jsonOptions.Converters.Add(new FeedbackModelJsonConverter());
            _jsonOptions.Converters.Add(new FeedbackUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new FileMetaJsonConverter());
            _jsonOptions.Converters.Add(new FileMetadataResponseJsonConverter());
            _jsonOptions.Converters.Add(new FileModelJsonConverter());
            _jsonOptions.Converters.Add(new FileModelResponseJsonConverter());
            _jsonOptions.Converters.Add(new FolderFormJsonConverter());
            _jsonOptions.Converters.Add(new FolderIsExpandedFormJsonConverter());
            _jsonOptions.Converters.Add(new FolderModelJsonConverter());
            _jsonOptions.Converters.Add(new FolderParentIdFormJsonConverter());
            _jsonOptions.Converters.Add(new FormatJsonConverter());
            _jsonOptions.Converters.Add(new FunctionFormJsonConverter());
            _jsonOptions.Converters.Add(new FunctionMetaJsonConverter());
            _jsonOptions.Converters.Add(new FunctionModelJsonConverter());
            _jsonOptions.Converters.Add(new FunctionResponseJsonConverter());
            _jsonOptions.Converters.Add(new GeminiConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new GenerateCompletionFormJsonConverter());
            _jsonOptions.Converters.Add(new GenerateEmbedFormJsonConverter());
            _jsonOptions.Converters.Add(new GenerateEmbeddingsFormJsonConverter());
            _jsonOptions.Converters.Add(new GenerateImageFormJsonConverter());
            _jsonOptions.Converters.Add(new GroupFormJsonConverter());
            _jsonOptions.Converters.Add(new GroupResponseJsonConverter());
            _jsonOptions.Converters.Add(new GroupUpdateFormJsonConverter());
            _jsonOptions.Converters.Add(new HTTPValidationErrorJsonConverter());
            _jsonOptions.Converters.Add(new HashJsonConverter());
            _jsonOptions.Converters.Add(new ImageConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new ImportConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new InputJsonConverter());
            _jsonOptions.Converters.Add(new KeepAliveJsonConverter());
            _jsonOptions.Converters.Add(new KeyJsonConverter());
            _jsonOptions.Converters.Add(new KnowledgeFileIdFormJsonConverter());
            _jsonOptions.Converters.Add(new KnowledgeFilesResponseJsonConverter());
            _jsonOptions.Converters.Add(new KnowledgeFormJsonConverter());
            _jsonOptions.Converters.Add(new KnowledgeResponseJsonConverter());
            _jsonOptions.Converters.Add(new KnowledgeResponseFilesInnerJsonConverter());
            _jsonOptions.Converters.Add(new KnowledgeUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new LdapConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new LdapFormJsonConverter());
            _jsonOptions.Converters.Add(new LdapServerConfigJsonConverter());
            _jsonOptions.Converters.Add(new LoadUrlFormJsonConverter());
            _jsonOptions.Converters.Add(new MarkdownFormJsonConverter());
            _jsonOptions.Converters.Add(new MemoryModelJsonConverter());
            _jsonOptions.Converters.Add(new MemoryUpdateModelJsonConverter());
            _jsonOptions.Converters.Add(new MessageModelJsonConverter());
            _jsonOptions.Converters.Add(new MessageUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new MetaJsonConverter());
            _jsonOptions.Converters.Add(new MetadataJsonConverter());
            _jsonOptions.Converters.Add(new ModelJsonConverter());
            _jsonOptions.Converters.Add(new ModelFormJsonConverter());
            _jsonOptions.Converters.Add(new ModelIdJsonConverter());
            _jsonOptions.Converters.Add(new ModelMetaJsonConverter());
            _jsonOptions.Converters.Add(new ModelModelJsonConverter());
            _jsonOptions.Converters.Add(new ModelNameFormJsonConverter());
            _jsonOptions.Converters.Add(new ModelResponseJsonConverter());
            _jsonOptions.Converters.Add(new ModelUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new ModelsConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new NameJsonConverter());
            _jsonOptions.Converters.Add(new NoteFormJsonConverter());
            _jsonOptions.Converters.Add(new NoteModelJsonConverter());
            _jsonOptions.Converters.Add(new NoteUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiModelsAuthsUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiModelsMessagesMessageFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiModelsUsersUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersChatsMessageFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersEvaluationsUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersImagesConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersImagesOpenAIConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersOllamaConnectionVerificationFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersOllamaOllamaConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersOpenaiConnectionVerificationFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersOpenaiOpenAIConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersRetrievalConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersRetrievalOllamaConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersRetrievalOpenAIConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new OpenWebuiRoutersUsersUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new PathJsonConverter());
            _jsonOptions.Converters.Add(new ProcessFileFormJsonConverter());
            _jsonOptions.Converters.Add(new ProcessTextFormJsonConverter());
            _jsonOptions.Converters.Add(new ProcessUrlFormJsonConverter());
            _jsonOptions.Converters.Add(new ProfileImageUrlJsonConverter());
            _jsonOptions.Converters.Add(new PromptFormJsonConverter());
            _jsonOptions.Converters.Add(new PromptModelJsonConverter());
            _jsonOptions.Converters.Add(new PromptSuggestionJsonConverter());
            _jsonOptions.Converters.Add(new PromptUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new PushModelFormJsonConverter());
            _jsonOptions.Converters.Add(new QueryCollectionsFormJsonConverter());
            _jsonOptions.Converters.Add(new QueryDocFormJsonConverter());
            _jsonOptions.Converters.Add(new QueryMemoryFormJsonConverter());
            _jsonOptions.Converters.Add(new RatingJsonConverter());
            _jsonOptions.Converters.Add(new RatingDataJsonConverter());
            _jsonOptions.Converters.Add(new ReactionFormJsonConverter());
            _jsonOptions.Converters.Add(new ReactionsJsonConverter());
            _jsonOptions.Converters.Add(new ReasonJsonConverter());
            _jsonOptions.Converters.Add(new STTConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new SearchFormJsonConverter());
            _jsonOptions.Converters.Add(new SessionUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new SetBannersFormJsonConverter());
            _jsonOptions.Converters.Add(new SetDefaultSuggestionsFormJsonConverter());
            _jsonOptions.Converters.Add(new SharingPermissionsJsonConverter());
            _jsonOptions.Converters.Add(new SiblingModelIdsJsonConverter());
            _jsonOptions.Converters.Add(new SigninFormJsonConverter());
            _jsonOptions.Converters.Add(new SigninResponseJsonConverter());
            _jsonOptions.Converters.Add(new SignupFormJsonConverter());
            _jsonOptions.Converters.Add(new SizeJsonConverter());
            _jsonOptions.Converters.Add(new SnapshotDataJsonConverter());
            _jsonOptions.Converters.Add(new StreamJsonConverter());
            _jsonOptions.Converters.Add(new SyncFunctionsFormJsonConverter());
            _jsonOptions.Converters.Add(new TTSConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new TagFilterFormJsonConverter());
            _jsonOptions.Converters.Add(new TagFormJsonConverter());
            _jsonOptions.Converters.Add(new TagModelJsonConverter());
            _jsonOptions.Converters.Add(new TaskConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new ToolFormJsonConverter());
            _jsonOptions.Converters.Add(new ToolMetaJsonConverter());
            _jsonOptions.Converters.Add(new ToolModelJsonConverter());
            _jsonOptions.Converters.Add(new ToolResponseJsonConverter());
            _jsonOptions.Converters.Add(new ToolServerConnectionJsonConverter());
            _jsonOptions.Converters.Add(new ToolServersConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new ToolUserResponseJsonConverter());
            _jsonOptions.Converters.Add(new UiJsonConverter());
            _jsonOptions.Converters.Add(new UpdateConfigFormJsonConverter());
            _jsonOptions.Converters.Add(new UpdatePasswordFormJsonConverter());
            _jsonOptions.Converters.Add(new UpdateProfileFormJsonConverter());
            _jsonOptions.Converters.Add(new UrlFormJsonConverter());
            _jsonOptions.Converters.Add(new UserListResponseJsonConverter());
            _jsonOptions.Converters.Add(new UserModelJsonConverter());
            _jsonOptions.Converters.Add(new UserNameResponseJsonConverter());
            _jsonOptions.Converters.Add(new UserPermissionsJsonConverter());
            _jsonOptions.Converters.Add(new UserSettingsJsonConverter());
            _jsonOptions.Converters.Add(new UserUpdateFormJsonConverter());
            _jsonOptions.Converters.Add(new ValidationErrorJsonConverter());
            _jsonOptions.Converters.Add(new ValidationErrorLocInnerJsonConverter());
            _jsonOptions.Converters.Add(new WebConfigJsonConverter());
            _jsonOptions.Converters.Add(new WorkspacePermissionsJsonConverter());
            JsonSerializerOptionsProvider jsonSerializerOptionsProvider = new(_jsonOptions);
            _services.AddSingleton(jsonSerializerOptionsProvider);
            _services.AddSingleton<IApiFactory, ApiFactory>();
            _services.AddSingleton<AudioApiEvents>();
            _services.AddSingleton<AuthsApiEvents>();
            _services.AddSingleton<ChannelsApiEvents>();
            _services.AddSingleton<ChatsApiEvents>();
            _services.AddSingleton<ConfigsApiEvents>();
            _services.AddSingleton<DefaultApiEvents>();
            _services.AddSingleton<EvaluationsApiEvents>();
            _services.AddSingleton<FilesApiEvents>();
            _services.AddSingleton<FoldersApiEvents>();
            _services.AddSingleton<FunctionsApiEvents>();
            _services.AddSingleton<GroupsApiEvents>();
            _services.AddSingleton<ImagesApiEvents>();
            _services.AddSingleton<KnowledgeApiEvents>();
            _services.AddSingleton<MemoriesApiEvents>();
            _services.AddSingleton<ModelsApiEvents>();
            _services.AddSingleton<NotesApiEvents>();
            _services.AddSingleton<OllamaApiEvents>();
            _services.AddSingleton<OpenaiApiEvents>();
            _services.AddSingleton<PipelinesApiEvents>();
            _services.AddSingleton<PromptsApiEvents>();
            _services.AddSingleton<RetrievalApiEvents>();
            _services.AddSingleton<TasksApiEvents>();
            _services.AddSingleton<ToolsApiEvents>();
            _services.AddSingleton<UsersApiEvents>();
            _services.AddSingleton<UtilsApiEvents>();
        }

        /// <summary>
        /// Configures the HttpClients.
        /// </summary>
        /// <param name="client"></param>
        /// <param name="builder"></param>
        /// <returns></returns>
        public HostConfiguration AddApiHttpClients
        (
            Action<HttpClient>? client = null, Action<IHttpClientBuilder>? builder = null)
        {
            if (client == null)
                client = c => c.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS);

            List<IHttpClientBuilder> builders = new List<IHttpClientBuilder>();

            builders.Add(_services.AddHttpClient<IAudioApi, AudioApi>(client));
            builders.Add(_services.AddHttpClient<IAuthsApi, AuthsApi>(client));
            builders.Add(_services.AddHttpClient<IChannelsApi, ChannelsApi>(client));
            builders.Add(_services.AddHttpClient<IChatsApi, ChatsApi>(client));
            builders.Add(_services.AddHttpClient<IConfigsApi, ConfigsApi>(client));
            builders.Add(_services.AddHttpClient<IDefaultApi, DefaultApi>(client));
            builders.Add(_services.AddHttpClient<IEvaluationsApi, EvaluationsApi>(client));
            builders.Add(_services.AddHttpClient<IFilesApi, FilesApi>(client));
            builders.Add(_services.AddHttpClient<IFoldersApi, FoldersApi>(client));
            builders.Add(_services.AddHttpClient<IFunctionsApi, FunctionsApi>(client));
            builders.Add(_services.AddHttpClient<IGroupsApi, GroupsApi>(client));
            builders.Add(_services.AddHttpClient<IImagesApi, ImagesApi>(client));
            builders.Add(_services.AddHttpClient<IKnowledgeApi, KnowledgeApi>(client));
            builders.Add(_services.AddHttpClient<IMemoriesApi, MemoriesApi>(client));
            builders.Add(_services.AddHttpClient<IModelsApi, ModelsApi>(client));
            builders.Add(_services.AddHttpClient<INotesApi, NotesApi>(client));
            builders.Add(_services.AddHttpClient<IOllamaApi, OllamaApi>(client));
            builders.Add(_services.AddHttpClient<IOpenaiApi, OpenaiApi>(client));
            builders.Add(_services.AddHttpClient<IPipelinesApi, PipelinesApi>(client));
            builders.Add(_services.AddHttpClient<IPromptsApi, PromptsApi>(client));
            builders.Add(_services.AddHttpClient<IRetrievalApi, RetrievalApi>(client));
            builders.Add(_services.AddHttpClient<ITasksApi, TasksApi>(client));
            builders.Add(_services.AddHttpClient<IToolsApi, ToolsApi>(client));
            builders.Add(_services.AddHttpClient<IUsersApi, UsersApi>(client));
            builders.Add(_services.AddHttpClient<IUtilsApi, UtilsApi>(client));
            
            if (builder != null)
                foreach (IHttpClientBuilder instance in builders)
                    builder(instance);

            HttpClientsAdded = true;

            return this;
        }

        /// <summary>
        /// Configures the JsonSerializerSettings
        /// </summary>
        /// <param name="options"></param>
        /// <returns></returns>
        public HostConfiguration ConfigureJsonOptions(Action<JsonSerializerOptions> options)
        {
            options(_jsonOptions);

            return this;
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="token"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(TTokenBase token) where TTokenBase : TokenBase
        {
            return AddTokens(new TTokenBase[]{ token });
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="tokens"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(IEnumerable<TTokenBase> tokens) where TTokenBase : TokenBase
        {
            TokenContainer<TTokenBase> container = new TokenContainer<TTokenBase>(tokens);
            _services.AddSingleton(services => container);

            return this;
        }

        /// <summary>
        /// Adds a token provider to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenProvider"></typeparam>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <returns></returns>
        public HostConfiguration UseProvider<TTokenProvider, TTokenBase>() 
            where TTokenProvider : TokenProvider<TTokenBase>
            where TTokenBase : TokenBase
        {
            _services.AddSingleton<TTokenProvider>();
            _services.AddSingleton<TokenProvider<TTokenBase>>(services => services.GetRequiredService<TTokenProvider>());

            return this;
        }
    }
}
